<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitaxe Monitor</title>
    <link rel="stylesheet" href="/css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <span class="status-indicator" id="statusIndicator"></span>
                Bitaxe Monitor
            </h1>
            <div style="display: flex; align-items: center; gap: 16px;">
                <span class="last-update" id="lastUpdate">Loading...</span>
                <button class="refresh-btn" onclick="fetchData()" id="refreshBtn">Refresh</button>
            </div>
        </header>

        <div class="swarm-summary">
            <h2>Swarm Overview</h2>
            <div class="swarm-stats" id="swarmStats">
                <div class="stat-item">
                    <div class="stat-value hashrate" id="totalHashrate">--</div>
                    <div class="stat-label">Total Hashrate</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="activeMiners">--</div>
                    <div class="stat-label">Active Miners</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value efficiency" id="avgEfficiency">--</div>
                    <div class="stat-label">Avg Efficiency</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value power" id="totalPower">--</div>
                    <div class="stat-label">Total Power</div>
                </div>
            </div>
        </div>

        <!-- Hashrate Chart -->
        <div class="swarm-summary" style="margin-bottom: 24px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <h2 id="chartTitle" style="margin: 0;">Hashrate (2h)</h2>
                <select id="chartDeviceSelect" style="background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 4px; padding: 4px 8px; font-size: 14px;">
                    <option value="">All Miners (Swarm)</option>
                </select>
            </div>
            <div style="height: 200px;">
                <canvas id="hashrateChart"></canvas>
            </div>
        </div>

        <div class="miner-grid" id="minerGrid">
            <div class="loading">Loading miners...</div>
        </div>
    </div>

    <!-- Control Modal -->
    <div class="modal-overlay" id="controlModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title" id="modalTitle">Miner Settings</span>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>

            <div class="status-message" id="statusMessage"></div>

            <div class="current-settings" id="currentSettings">
                <div class="current-settings-row">
                    <span class="current-settings-label">Current Frequency</span>
                    <span id="currentFreq">-- MHz</span>
                </div>
                <div class="current-settings-row">
                    <span class="current-settings-label">Current Voltage</span>
                    <span id="currentVoltage">-- mV</span>
                </div>
                <div class="current-settings-row">
                    <span class="current-settings-label">Current Fan</span>
                    <span id="currentFan">--%</span>
                </div>
            </div>

            <div class="control-group">
                <div class="control-label">
                    <span>Frequency</span>
                </div>
                <div class="control-input-row">
                    <input type="range" class="control-slider" id="freqSlider"
                           min="400" max="650" step="25" value="575">
                    <input type="number" class="control-number-input" id="freqInput"
                           min="400" max="650" step="25" value="575">
                    <span class="control-unit">MHz</span>
                </div>
                <div class="control-buttons">
                    <button class="control-btn primary" onclick="applyFrequency()">Apply</button>
                </div>
            </div>

            <div class="control-group">
                <div class="control-label">
                    <span>Core Voltage</span>
                </div>
                <div class="control-input-row">
                    <input type="range" class="control-slider" id="voltageSlider"
                           min="1000" max="1300" step="10" value="1200">
                    <input type="number" class="control-number-input" id="voltageInput"
                           min="1000" max="1300" step="10" value="1200">
                    <span class="control-unit">mV</span>
                </div>
                <div class="control-buttons">
                    <button class="control-btn primary" onclick="applyVoltage()">Apply</button>
                </div>
            </div>

            <div class="control-group">
                <div class="control-label">
                    <span>Fan Speed</span>
                </div>
                <div class="fan-toggle">
                    <button class="fan-toggle-btn" id="fanAutoBtn" onclick="setFanMode('auto')">Auto</button>
                    <button class="fan-toggle-btn" id="fanManualBtn" onclick="setFanMode('manual')">Manual</button>
                </div>

                <!-- Auto Fan Settings -->
                <div id="autoFanSettings" style="display: none;">
                    <div class="control-input-row" style="margin-bottom: 8px;">
                        <span style="min-width: 100px; color: var(--text-secondary);">Target Temp</span>
                        <input type="range" class="control-slider" id="tempTargetSlider"
                               min="40" max="75" step="1" value="65">
                        <input type="number" class="control-number-input" id="tempTargetInput"
                               min="40" max="75" step="1" value="65">
                        <span class="control-unit">Â°C</span>
                    </div>
                    <div class="control-input-row">
                        <span style="min-width: 100px; color: var(--text-secondary);">Min Fan</span>
                        <input type="range" class="control-slider" id="minFanSlider"
                               min="0" max="100" step="5" value="0">
                        <input type="number" class="control-number-input" id="minFanInput"
                               min="0" max="100" step="5" value="0">
                        <span class="control-unit">%</span>
                    </div>
                </div>

                <!-- Manual Fan Settings -->
                <div id="manualFanSettings">
                    <div class="control-input-row">
                        <input type="range" class="control-slider" id="fanSlider"
                               min="0" max="100" step="5" value="100">
                        <input type="number" class="control-number-input" id="fanInput"
                               min="0" max="100" step="5" value="100">
                        <span class="control-unit">%</span>
                    </div>
                </div>

                <div class="control-buttons">
                    <button class="control-btn primary" id="applyFanBtn" onclick="applyFan()">Apply</button>
                </div>
            </div>

            <div class="control-group" style="margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--border);">
                <button class="control-btn danger" style="width: 100%;" onclick="restartMiner()">Restart Miner</button>
            </div>
        </div>
    </div>

    <!-- Application Scripts -->
    <script src="/js/app.js"></script>
    <script src="/js/controls.js"></script>
</body>
</html>
